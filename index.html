<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-344HH6C92L"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());
    gtag('config', 'G-344HH6C92L');
  </script>

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MJKXWG7G');</script>
  <!-- End Google Tag Manager -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flappy Bird â€“ One File</title>

  <style>
    body {
      margin: 0;
      background: linear-gradient(#60a5fa, #93c5fd);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    canvas {
      width: 100vw;
      height: 100vh;
      background: linear-gradient(#38bdf8, #bae6fd);
      border-radius: 0;
      box-shadow: none;
    }

    .hint {
      position: absolute;
      bottom: 30px;
      color: white;
      opacity: 0.8;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MJKXWG7G"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <canvas id="game"></canvas>
  <div class="hint">Clique ou appuie sur Espace pour voler</div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    window.addEventListener('resize', resize);
    resize();

    const gravity = 0.5;
    const jump = -8;
    const pipeGap = 130;
    const pipeWidth = 50;

    let bird = { x: 150, y: window.innerHeight / 2, v: 0, r: 18 };
    let pipes = [];
    let score = 0;
    let best = 0;
    let gameOver = false;

    function reset() {
      bird.y = 200;
      bird.v = 0;
      pipes = [];
      score = 0;
      gameOver = false;
    }

    function spawnPipe() {
      const topHeight = Math.random() * 200 + 40;
      pipes.push({
        x: canvas.width,
        top: topHeight,
        bottom: topHeight + pipeGap,
        passed: false
      });
    }

    function update() {
      if (gameOver) return;

      bird.v += gravity;
      bird.y += bird.v;

      if (bird.y + bird.r > canvas.height || bird.y - bird.r < 0) {
        endGame();
      }

      for (let pipe of pipes) {
        pipe.x -= 2.5;

        if (!pipe.passed && pipe.x + pipeWidth < bird.x) {
          pipe.passed = true;
          score++;
        }

        if (
          bird.x + bird.r > pipe.x &&
          bird.x - bird.r < pipe.x + pipeWidth &&
          (bird.y - bird.r < pipe.top || bird.y + bird.r > pipe.bottom)
        ) {
          endGame();
        }
      }

      pipes = pipes.filter(p => p.x + pipeWidth > 0);
    }

    function endGame() {
      gameOver = true;
      best = Math.max(best, score);
    }

    function drawBird() {
      ctx.fillStyle = '#facc15';
      ctx.beginPath();
      ctx.arc(bird.x, bird.y, bird.r, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawPipes() {
      ctx.fillStyle = '#22c55e';
      for (let pipe of pipes) {
        ctx.fillRect(pipe.x, 0, pipeWidth, pipe.top);
        ctx.fillRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom);
      }
    }

    function drawText() {
      ctx.fillStyle = 'white';
      ctx.textAlign = 'center';

      ctx.font = '28px Arial';
      ctx.fillText(score, canvas.width / 2, 60);

      if (gameOver) {
        ctx.font = '20px Arial';
        ctx.fillText('Game Over', canvas.width / 2, canvas.height / 2 - 20);
        ctx.fillText('Clique pour rejouer', canvas.width / 2, canvas.height / 2 + 10);
        ctx.fillText('Best : ' + best, canvas.width / 2, canvas.height / 2 + 40);
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPipes();
      drawBird();
      drawText();
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    function flap() {
      if (gameOver) reset();
      bird.v = jump;
    }

    document.addEventListener('keydown', e => {
      if (e.code === 'Space') flap();
    });

    canvas.addEventListener('mousedown', flap);
    canvas.addEventListener('touchstart', flap);

    setInterval(() => {
      if (!gameOver) spawnPipe();
    }, 1500);

    loop();
  </script>
</body>
</html>
